(function(a){var w=a(".item.laden"),x=a(".item.login"),l=a(".eintraege"),y=a(".steuer-wrapper"),n=a(".item.lokal"),z=a(".templates"),A=a(".item.login").find("form"),B=a(".item.login").find(".passwort"),C=a("#input-klasse"),q=a("#input-tag"),D=a("#input-klasse").find("li"),u=a("#input-klasse").find(".optionen"),r=a("#input-klasse").find(".header"),v=a("#input-tag").find("li");a("#input-tag").find(".optionen");var e={nullPad:function(d,a){for(var m=String(d),f="",b=0;b<a;b++)f+="0";return(f+m).substring(m.length)},
template:function(){var d=[],c;z.children().each(function(m,f){void 0!==(c=a(this).data("template"))&&(d[c]=a(this).html())});return function(c,f){var b=d[c];a.each(f,function(d,a){b=b.replace(new RegExp("{{"+d+"}}","g"),a)});return b}}(),eight:function(){var d;try{d=new Audio("eight.mp3"),d.preload=!0}catch(a){}return function(){void 0!==d&&(d.pause(),d.currentTime=0,d.play())}}()},g=function(){var d,c="Januar Februar M\u00e4rz April Mai Juni Juli August September Oktober November Dezember".split(" "),
m=/\d+\. (\w+)/,f=!1;return{setVertretungsplanObjekt:function(b){try{d=a.parseJSON(b)}catch(f){}if(void 0!==d){b=1;for(var k=new Date;1!=k.getDay();)k.setDate(k.getDate()-1);for(;5>=b;b++){$tag=q.find("li[data-value='"+b+"'] .lang");if(0==$tag.text().trim().length){var e=k.getDate()+"."+(k.getMonth()+1)+"."+k.getFullYear();$tag.text(e)}k.setDate(k.getDate()+1)}a.each(d.plaene,function(d,b){for(var a=b.meta.datum,a=a.substring(0,a.lastIndexOf(" ")),k=m.exec(a)[1],f=0;f<c.length&&c[f]!=k;f++);a=a.replace(k,
f+1+".").replace(/\s/g,"");q.find("li[data-value='"+b.tag+"'] .lang").text(a)})}},aktualisiereVertretungsplanAnsicht:function(){if(void 0!==d){l.empty();var b;a.each(d.plaene,function(a,d){if(d.tag==t.getWochentag())return b=d,!1});if(void 0===b)l.append(a(e.template("info",{html:"F\u00fcr diesen Wochentag liegen keine Vertretungspl\u00e4ne vor."})));else{0<b.info.length&&l.append(a(e.template("info",{html:b.info})));if(f){var c=new Date;c.setTime(h.getLetzterVertretungsplanTimestamp());c=c.getDate()+
"."+(c.getMonth()+1)+"."+c.getFullYear()+" "+e.nullPad(c.getHours(),2)+":"+e.nullPad(c.getMinutes(),2)+":"+e.nullPad(c.getSeconds(),2);n.find(".timestamp").text(c);n.slideDown(400)}var m=!1;a.each(b.liste,function(a,d){if(-1!=d.klasse.indexOf(t.getKlasse()))return m=!0,!1});if(m){var g,p="";a.each(b.liste,function(d,b){if(-1!=b.klasse.indexOf(t.getKlasse())){if(g!=b.stunde){if(void 0!==g){var c=a(e.template("eintrag",{stunde:e.nullPad(g,2),meta:p}));l.append(c)}g=b.stunde;p=""}p+=e.template("subeintrag",
{fachUndRaum:b.fach+" in "+b.raum+(void 0!==b.extra?" ("+b.extra+")":""),lehrer:b.lehrer,info:b.info})}});0<p.length&&(c=a(e.template("eintrag",{stunde:e.nullPad(g,2),meta:p})),8==g&&c.find(".stunde").click(e.eight),l.append(c))}else l.append(e.template("item",{html:"Es liegen keine Vertretungen f\u00fcr diese Klasse/diesen Jahrgang vor."}));0<b.meta.abwesendk.length&&l.append(e.template("meta",{html:"<b>Abwesende Klassen:</b> "+b.meta.abwesendk}));0<b.meta.aenderungl.length&&l.append(e.template("meta",
{html:"<b>Lehrer mit \u00c4nderungen:</b> "+b.meta.aenderungl}))}}},setZeigeLokaleKopieInfo:function(b){f=b},zeigeVertretungsplan:function(){l.slideDown(400);y.slideDown(400)}}}(),h=function(){var a=window.localStorage||function(){var a={};return{setItem:function(d,f){a[d]=String(f)},getItem:function(d){return a[d]},removeItem:function(d){delete a[d]},clear:function(){a={}}}}();return{getLetzterWochentag:function(){return parseInt(a.getItem("aktuellerTag")||1)},getLetzteKlasse:function(){return a.getItem("aktuelleKlasse")||
"5a"},getLetztePruefsumme:function(){return a.getItem("letzteHash")||""},getLetzterVertretungsplan:function(){return a.getItem("letzterVP")||""},getLetzterVertretungsplanTimestamp:function(){return parseInt(a.getItem("letzteTimestamp")||0)},setKlasse:function(c){a.setItem("aktuelleKlasse",c)},setWochentag:function(c){a.setItem("aktuellerTag",c)},setLetztePruefsumme:function(c){a.setItem("letzteHash",c)},setLetzterVertretungsplan:function(c){a.setItem("letzterVP",c)},setLetzterVertretungsplanTimestamp:function(c){a.setItem("letzteTimestamp",
c)}}}();/^\d+$/.test(String(h.getLetzteKlasse()))&&h.setKlasse("5a");var t=function(){function d(a){e!==a.data("value")&&(e=a.data("value"),r.text(a.text()),h.setKlasse(e),g.aktualisiereVertretungsplanAnsicht())}function c(a){f!==a.data("value")&&(f=a.data("value"),v.removeClass("ausgewaehlt"),a.addClass("ausgewaehlt"),h.setWochentag(f),g.aktualisiereVertretungsplanAnsicht())}var e,f;(function(){D.click(function(){$this=a(this);d($this);r.toggleClass("expand");u.slideToggle(200)});r.click(function(){a(this).toggleClass("expand");
u.slideToggle(200)});var b=C.find("li[data-value='"+h.getLetzteKlasse()+"']");d(b)})();(function(){v.click(function(){c(a(this))});var b=q.find("li[data-value='"+h.getLetzterWochentag()+"']");c(b)})();(function(){n.find(".spoiler").click(function(){a(this).toggleClass("aktiviert");a(this).hasClass("aktiviert")?n.find(".beschreibung").slideDown(400):n.find(".beschreibung").slideUp(400)})})();(function(){A.submit(function(a){0==B.val().trim().length&&(alert("Passwortfeld ist leer. Bitte Eingabe \u00fcberpr\u00fcfen."),
a.preventDefault())})})();return{getKlasse:function(){return e},getWochentag:function(){return f}}}();a.ajax({url:"api/vp.php",timeout:5E3,dataType:"json",data:{c:h.getLetztePruefsumme()}}).always(function(){w.slideUp(400)}).done(function(a,c,e){h.setLetzterVertretungsplan(e.responseText);h.setLetztePruefsumme(a.pruefsumme);h.setLetzterVertretungsplanTimestamp((new Date).getTime());g.setVertretungsplanObjekt(e.responseText);g.aktualisiereVertretungsplanAnsicht();g.zeigeVertretungsplan()}).fail(function(a){a=
a.status;401==a?x.slideDown(400):(400!=a&&g.setZeigeLokaleKopieInfo(!0),g.setVertretungsplanObjekt(h.getLetzterVertretungsplan()),g.aktualisiereVertretungsplanAnsicht(),g.zeigeVertretungsplan())})})(jQuery);